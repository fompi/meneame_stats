---
title: "¿Qué noticias suben a portada de menéame?"
output:
  html_document: default
  pdf_document:
    latex_engine: xelatex
    fig_caption: yes
always_allow_html: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#options(width = SOME-REALLY-BIG-VALUE)

#Librerias
library(dplyr)
library(car)
library(data.table)
library(ggplot2)
library(plotly)
library(lubridate)
library(tm)
library(wordcloud)

#Funciones
ts_mensual <- function(db){
  db %>%
    mutate(date = format(fecha_publicacion, "%Y-%m")) %>%
    group_by(date) %>% 
    count(fecha_publicacion) %>% summarise(total=sum(n))
}

ts_anual <- function(db){
  db %>%
    mutate(date = format(fecha_publicacion, "%Y")) %>%
    group_by(date) %>% 
    count(fecha_publicacion) %>% summarise(total=sum(n))
}

sub_set <- function(df, colum, val){
  return (df[df[,colum]==val,])
}

#Directorio
#setwd(file.path("D:", "Programacion", "Python", "Proyecto meneame"))
#setwd(file.path("media","usuario","Mula", "Programacion", "Python", "Proyecto meneame"))

#Leemos los datos
#dt_portada <- fread("portada.csv", sep=";", header = TRUE, encoding="UTF-8")
dt_portada <- read.csv("portada.csv", sep=";", header = TRUE, encoding="UTF-8")


#Cambiamos los espacios en blanco por NAN's
#dt_portada <- dt_portada %>%
#  mutate_if(is.factor, funs(factor(replace(., .=="", NA))))
#dt_portada <- dt_portada[rowSums(is.na(dt_portada)) == 0,]

#Declaramos series temporales
dt_portada$fecha_envio <- as.POSIXct(dt_portada$fecha_envio, origin = "1970-01-01") 
dt_portada$fecha_publicacion <- as.POSIXct(dt_portada$fecha_publicacion, origin = "1970-01-01") 
```

## ¿Qué noticias se suben a menéame?

Ando estos días aburrido buscando trabajo. Entonces, viendo las noticias de portada me pregunté sobre el tipo de noticias que acaban subiendo a la portada de menéame, y pensé que se podían hacer algunos análisis interesantes. Dicho y hecho, hice un crawler en Python y extraje la información de todas las noticias que han subido a portada desde la creación de la web. 

La fecha de extracción de la información fue el 4 de diciembre de 2017 por la mañana. Como primeros datos, apuntar que se han extraído unas 170.000 noticias con sus meneos, fecha de envío, fecha de publicación, karma, clics, votos positivos y negativos, etc... 

## ¿Cuál es el origen de las noticias?

Los orígenes de las noticias subidas a menéame son muy diversos. Agrupando el origen de las noticias, aparecen unas 25.500 webs diferentes con una media de envíos de 7,1 y una mediana igual a 1. Aquí hay un problema, y es que la web almacena como elementos diferentes envíos que tienen el mismo origen. Por ejemplo, podemos encontrarnos con que la web del New York Times (nytimes.com), tiene envíos con origen en artsbeat.blogs.nytimes.com, bits.blogs.nytimes.com o cityroom.blogs.nytimes.com. Entonces, para eliminar inconsistencias se ha procedido a la estandarización del origen de los envíos. Este proceso se ha realizado con los sitios que tenían al menos 200 noticias publicadas. Tras hacer esto, el número de sitios de origen se ha reducido en unos 800.


```{r meneame_1, include=FALSE}
######### Recoding variable web ######### 
#elmundo.es
dt_portada$web <-recode(dt_portada$web, "c('aula.elmundo.es', 'quiosco.elmundo.orbyt.es', 'elmundo.orbyt.es', 'elmundodeporte.elmundo.es',
                        'elmundomotor.elmundo.es', 'elmundosalud.elmundo.es', 'elmundovino.elmundo.es', 'estaticos.elmundo.es', 
                        'foros.elmundo.es', 'navegante2.elmundo.es', 'sv.elmundo.es', 'rsocial.elmundo.orbyt.es')='elmundo.es'")
#elpais.com
dt_portada$web <-recode(dt_portada$web, "c('bandaancha.elpais.es', 'blogs.elpais.com', 'blogs.smoda.elpais.com', 'ccaa.elpais.com', 
                        'cultura.elpais.com', 'deportes.elpais.com', 'economia.elpais.com', 'elpais.es', 'elviajero.elpais.com', 
                        'eskup.elpais.com', 'foros.elpais.com', 'internacional.elpais.com', 'lacomunidad.elpais.com', 
                        'pda.elpais.com', 'politica.elpais.com', 'smoda.elpais.com', 'sociedad.elpais.com', 
                        'tecnologia.elpais.com', 'tentaciones.elpais.com', 'www-org.elpais.com')='elpais.com'")

#europapress.es
dt_portada$web <-recode(dt_portada$web, "c('europapress.com', 'm.europapress.es', 'amp.europapress.es', 'europapress.cat', 
                        'blogs.europapress.es', 'europapress.tumblr.com', 'europapress.tv', 't.europapress.es')='europapress.es'")

#publico.es
dt_portada$web <-recode(dt_portada$web, "c('blogs.publico.es', 'tremending.publico.es', 'charlas.publico.es', 'video.publico.es', 
                        'especiales.publico.es', 'imagenes.publico-estaticos.es', 'imagenes.publico.es')='publico.es'")

#youtube.com
dt_portada$web <-recode(dt_portada$web, "c('es.youtube.com', 'br.youtube.com', 'mx.youtube.com', 'uk.youtube.com', 'au.youtube.com', 
                        'de.youtube.com', 'ie.youtube.com', 'ru.youtube.com', 'apiblog.youtube.com')='youtube.com'")

#20minutos.es
dt_portada$web <-recode(dt_portada$web, "c('blogs.20minutos.es', 'm.20minutos.es', '20minutos.tv', 'listas.20minutos.es', '20minutos.com', 
                        'clipset.20minutos.es', 'cdn.20minutos.es', 'foros.20minutos.es', 'amp.20minutos.es', 'estaticos.20minutos.es')='20minutos.es'")

#eldiario.es
dt_portada$web <-recode(dt_portada$web, "c('m.eldiario.es', 'vertele.eldiario.es', 'desmemoria.eldiario.es', 'images.eldiario.es')='eldiario.es'")

#elconfidencial.com
dt_portada$web <-recode(dt_portada$web, "c('blogs.elconfidencial.com', 'vanitatis.elconfidencial.com', 'blogs.vanitatis.elconfidencial.com', 
                        'gentleman.elconfidencial.com', 'nocache.elconfidencial.com')='elconfidencial.com'")

#abc.es
dt_portada$web <-recode(dt_portada$web, "c('sevilla.abc.es', 'abcblogs.abc.es', 'videos.abc.es', 'cordoba.abc.es', 
                        'hemeroteca.abc.es', 'participacion.abc.es', 'especiales.abc.es', 'lapalabraescrita.abc.es', 
                        'mundial-futbol.abc.es', 'sevilla-origin.abc.es', 'valencia.abc.es', 'videochat.abc.es')='abc.es'")

#cadenaser.com
dt_portada$web <-recode(dt_portada$web, "c('blogs.cadenaser.com', 'lacomunidad.cadenaser.com', 'play.cadenaser.com', 
                        'www-org.cadenaser.com', 'sdmedia.cadenaser.com')='cadenaser.com'")

#lavanguardia.es
dt_portada$web <-recode(dt_portada$web, "c('blogs.lavanguardia.es', 'yaencontre-lavanguardia.es', 'comunidad.lavanguardia.es', 
                        'lavanguardia.com', 'blogs.lavanguardia.com', 'videos.lavanguardia.com', 'enmemoria.lavanguardia.com', 
                        'hagoclic.lavanguardia.com')='lavanguardia.es'")

#lainformacion.com
dt_portada$web <-recode(dt_portada$web, "c('noticias.lainformacion.com', 'blogs.lainformacion.com', 'humor.lainformacion.com', 
                        '233grados.lainformacion.com', 'fotos.lainformacion.com', 'graficos.lainformacion.com', 
                        'videos.lainformacion.com', 'especiales.lainformacion.com', 'bolsa.lainformacion.com', 
                        'mundial.lainformacion.com', 'trabajo.practicopedia.lainformacion.com')='lainformacion.com'")

#vozpopuli.com
dt_portada$web <-recode(dt_portada$web, "c('tendencias.vozpopuli.com', 'bolsa.vozpopuli.com', 
                        'estatico.tendencias.vozpopuli.com', 'proveedor2.vozpopuli.com')='vozpopuli.com'")

#eleconomista.es
dt_portada$web <-recode(dt_portada$web, "c('ecodiario.eleconomista.es', 'ecoteuve.eleconomista.es', 
                        'ecoaula.eleconomista.es', 'informalia.eleconomista.es', 'listas.eleconomista.es')='eleconomista.es'")

#elperiodico.com
dt_portada$web <-recode(dt_portada$web, "c('elperiodico.es', 'epreader.elperiodico.com', 'staging.elperiodico.com', 'beta.elperiodico.es', 
                        'bolsa.elperiodico.com', 'elperiodico.cat', 'momentos.elperiodico.com', 'primerafila.elperiodico.com')='elperiodico.com'")

#elplural.com
dt_portada$web <-recode(dt_portada$web, "c('www2.elplural.com', 'amp.elplural.com', 't.elplural.com')='elplural.com'")

#lavozdegalicia.es
dt_portada$web <-recode(dt_portada$web, "c('blogs.lavozdegalicia.es', 'media.lavozdegalicia.es')='lavozdegalicia.es'")

#rtve.es
dt_portada$web <-recode(dt_portada$web, "c('blog.rtve.es', 'blogs.rtve.es', 'muchachadanui.rtve.es', 'extra.rtve.es', 
                        'eurovision2008.rtve.es', 'encuentrosdigitales.rtve.es', 'pluton.rtve.es', 
                        'resultados-elecciones.rtve.es')='rtve.es'")
#levante-emv.com
dt_portada$web <-recode(dt_portada$web, "c('comunidad.levante-emv.com', 'comunidades.levante-emv.com')='levante-emv.com'")

#es.gizmodo.com
dt_portada$web <-recode(dt_portada$web, "c('gizmodo.es', 'gizmodo.com', 'sploid.gizmodo.com', 'i.gizmodo.com', 
                        'factually.gizmodo.com', 'gizmodo.com.au', 'gizmodo.co.uk', 'gizmodo.com.br', 
                        'io9.gizmodo.com', 'lego.gizmodo.com', 'paleofuture.gizmodo.com', 'throb.gizmodo.com')='es.gizmodo.com'")
#yahoo.com
dt_portada$web <-recode(dt_portada$web, "c('es.noticias.yahoo.com', 'es.news.yahoo.com', 'news.yahoo.com', 'es.eurosport.yahoo.com', 
                        'es.finance.yahoo.com', 'espanol.news.yahoo.com', 'es-us.noticias.yahoo.com', 'ar.news.yahoo.com', 
                        'uk.news.yahoo.com', 'es.biz.yahoo.com', 'finance.yahoo.com', 'es.cars.yahoo.com', 'au.news.yahoo.com', 
                        'es.tv.yahoo.com', 'es.vida-estilo.yahoo.com', 'sports.yahoo.com', 'ca.news.yahoo.com', 'es.answers.yahoo.com', 
                        'es.movies.yahoo.com', 'ar.noticias.yahoo.com', 'mx.news.yahoo.com', 'es-us.deportes.yahoo.com', 'es.cine.yahoo.com', 
                        'es.tendencias.yahoo.com', 'es.viajes.yahoo.com', 'espanol.sports.yahoo.com', 'fr.news.yahoo.com', 'yahoo.com', 
                        'asia.news.yahoo.com', 'autos.yahoo.com', 'beta.es.noticias.yahoo.com', 'biz.yahoo.com', 'br.noticias.yahoo.com', 
                        'cl.noticias.yahoo.com', 'en-maktoob.news.yahoo.com', 'es-us.omg.yahoo.com', 'es-us.vida-estilo.yahoo.com', 
                        'es.celebrity.yahoo.com', 'es.groups.yahoo.com', 'es.guide.yahoo.com', 'es.news.launch.yahoo.com', 'es.omg.yahoo.com', 
                        'es.video.yahoo.com', 'es.videogames.games.yahoo.com', 'espanol.pfinance.yahoo.com', 'fe7.story.media.ac4.yahoo.com', 
                        'flickr.mud.yahoo.com', 'fr.voyage.yahoo.com', 'gma.yahoo.com', 'groups.yahoo.com', 'it.notizie.yahoo.com', 
                        'messages.finance.yahoo.com', 'movies.yahoo.com', 'mx.mujer.yahoo.com', 'mx.news.finance.yahoo.com', 
                        'mx.noticias.yahoo.com', 'nz.lifestyle.yahoo.com', 'pe.noticias.yahoo.com', 'potw.news.yahoo.com', 'shine.yahoo.com', 
                        'tech.yahoo.com', 'uk.eurosport.yahoo.com', 've.noticias.yahoo.com', 'video.yahoo.com', 'yodel.yahoo.com')='yahoo.com'")

#bbc.com
dt_portada$web <-recode(dt_portada$web, "c('bbc.co.uk', 'news.bbc.co.uk', 'news8.thdo.bbc.co.uk', 'm.bbc.co.uk', 
                        'm.bbc.com', 'open.bbc.co.uk')='bbc.com'")

#elboletin.com
dt_portada$web <-recode(dt_portada$web, "c('elboletin.es')='elboletin.com'")

#elespanol.com
dt_portada$web <-recode(dt_portada$web, "c('bluper.elespanol.com', 'cronicaglobal.elespanol.com', 'omicrono.elespanol.com', 
                        'diariodeavisos.elespanol.com', 'navarra.elespanol.com', 'elandroidelibre.elespanol.com', 
                        'cocinillas.elespanol.com', 'datos.elespanol.com', 'lab.elespanol.com', 'reportajes.elespanol.com')='elespanol.com'")

#lasexta.com
dt_portada$web <-recode(dt_portada$web, "c('lasextanoticias.com', 'elintermedio.lasexta.com', 'amp.lasexta.com', 'cqc.lasexta.com', 
                        'lasextadeportes.com', 'quevidamastriste.lasexta.com', 'buenafuente.lasexta.com', 'salvados.lasexta.com')='lasexta.com'")

#marca.com
dt_portada$web <-recode(dt_portada$web, "c('jjoo.marca.com', 'marcawas5.recoletos.es', 'marca.es', 'marca.recoletos.com')='marca.com'")

#expansion.com
dt_portada$web <-recode(dt_portada$web, "c('app2.expansion.com', 'nauta360.expansion.com', 'origin-www.expansion.com', 
                        'php.expansion.com', 'blogs.expansion.com')='expansion.com'")

#libertaddigital.com
dt_portada$web <-recode(dt_portada$web, "c('libertaddigital.es', 'findesemana.libertaddigital.com', 'revista.libertaddigital.com', 
                        'blogs.libertaddigital.com', 'esradio.libertaddigital.com', 'exteriores.libertaddigital.com', 
                        'historia.libertaddigital.com', 'libertaddigital.tv', 'libros.libertaddigital.com', 
                        'tv.libertaddigital.com')='libertaddigital.com'")

#terra.es
dt_portada$web <-recode(dt_portada$web, "c('actualidad.terra.es', 'noticias.terra.es', 'noticias.terra.com', 'terra.cl', 'terra.com', 
                        'noticias.terra.com.ar', 'motor.terra.es', 'noticias.terra.com.pe', 'mujer.terra.es', 'terra.org', 
                        'comunidad.terra.es', 'personal.telefonica.terra.es', 'noticias.terra.cl', 'noticias.terra.com.co', 
                        'terra.com.ar', 'terra.com.pe', 'deportes.terra.es', 'economia.terra.com.co', 'entretenimiento.terra.es', 
                        'terra.com.mx', 'eltiempo.terra.com.co', 'blogs.terra.es', 'co.terra.com', 'economia.terra.cl', 
                        'fzhelenmamy.blogs.terra.es', 'megagalerias.terra.cl', 'noticias.terra.com.mx', 'vidayestilo.terra.es', 
                        'ar.terra.com', 'deportes.terra.com.ar', 'deportes.terra.com.co', 'deportesar.terra.com.ar',
                        'economia.terra.com', 'economia.terra.com.ar', 'elcomercio.terra.com.ec', 'enter.terra.com.co', 
                        'entretenimiento.terra.com.ar', 'entretenimiento.terra.com.pe', 'juegos.blogs.terra.es', 'm.terra.cl', 
                        'musica.terra.com.mx', 'musica.terra.es', 'navidadlae.terra.es', 'noticias.terra.com.br', 'noticiascl.terra.cl', 
                        'paginas.terra.com.br', 'pe.terra.com', 'tecnologia.terra.com.br', 'terra.com.pr', 'terra.tv', 'terratv.terra.cl', 
                        'vidayestilo.terra.cl', 'vidayestilo.terra.com.ar', 'www3.terra.com.ar')='terra.es'")

#microsiervos.com
dt_portada$web <-recode(dt_portada$web, "c('wtf.microsiervos.com', 'eco.microsiervos.com', 'avion.microsiervos.com', 'foto.microsiervos.com', 
                        'juegos.microsiervos.com')='microsiervos.com'")

#cincodias.com
dt_portada$web <-recode(dt_portada$web, "c('blogs.cincodias.com')='cincodias.com'")

#genbeta.com
dt_portada$web <-recode(dt_portada$web, "c('genbetadev.com', 'm.genbeta.com', 't.genbeta.com', 'genbetasocialmedia.com')='genbeta.com'")

#xataka.com
dt_portada$web <-recode(dt_portada$web, "c('magnet.xataka.com', 'xatakaciencia.com', 'xatakamovil.com', 'xatakafoto.com', 'm.xataka.com', 
                        'm.magnet.xataka.com', 'xatakandroid.com', 'xatakaon.com', 'm.xatakaciencia.com', 't.xataka.com', 'xatakahome.com', 
                        'm.xatakandroid.com', 'esports.xataka.com', 'm.xatakahome.com', 't.xatakaciencia.com', 't.xatakaon.com', 
                        'xatakawindows.com')='xataka.com'")

#adslzone.net
dt_portada$web <-recode(dt_portada$web, "c('adslzone.tv', 'tv.adslzone.net', 'linux.adslzone.net', 'software.adslzone.net')='adslzone.net'")

#rt.com
dt_portada$web <-recode(dt_portada$web, "c('actualidad.rt.com')='rt.com'")

#telegraph.co.uk
dt_portada$web <-recode(dt_portada$web, "c('blogs.telegraph.co.uk')='telegraph.co.uk'")

#huffingtonpost.es
dt_portada$web <-recode(dt_portada$web, "c('huffingtonpost.com', 'huffingtonpost.co.uk', 'huffingtonpost.fr',
                        'huffingtonpost.ca', 'huffingtonpost.com.au', 'huffingtonpost.com.mx', 'huffingtonpost.it')='huffingtonpost.es'")

#flickr.com
dt_portada$web <-recode(dt_portada$web, "c('farm1.static.flickr.com', 'farm3.static.flickr.com', 'farm2.static.flickr.com', 
                        'static.flickr.com', 'blog.flickr.com', 'blog.flickr.net', 'c2.staticflickr.com', 'farm8.staticflickr.com', 
                        'photos3.flickr.com')='flickr.com'")

#lasprovincias.es
dt_portada$web <-recode(dt_portada$web, "c('bicivalencia.lasprovincias.es', 'blogs.lasprovincias.es', 'campusparty.lasprovincias.es', 
                        'especiales.lasprovincias.es', 'firmas.lasprovincias.es', 'servicios.lasprovincias.es', 'valenciacf.lasprovincias.es', 
                        'www1.lasprovincias.es')='lasprovincias.es'")

#nytimes.com
dt_portada$web <-recode(dt_portada$web, "c('artsbeat.blogs.nytimes.com', 'bits.blogs.nytimes.com', 'cityroom.blogs.nytimes.com', 
                        'dealbook.blogs.nytimes.com', 'dealbook.nytimes.com', 'gadgetwise.blogs.nytimes.com', 'graphics.nytimes.com',
                        'graphics8.nytimes.com', 'green.blogs.nytimes.com', 'greeninc.blogs.nytimes.com', 'krugman.blogs.nytimes.com', 
                        'laughlines.blogs.nytimes.com', 'lens.blogs.nytimes.com', 'mediadecoder.blogs.nytimes.com', 'mobile.nytimes.com',
                        'niemann.blogs.nytimes.com', 'open.nytimes.com', 'opinionator.blogs.nytimes.com', 'pogue.blogs.nytimes.com', 
                        'prescriptions.blogs.nytimes.com', 'projects.nytimes.com', 'query.nytimes.com', 'thecaucus.blogs.nytimes.com', 
                        'thelede.blogs.nytimes.com', 'travel.nytimes.com', 'well.blogs.nytimes.com')='nytimes.com'")

#lasprovincias.es
dt_portada$web <-recode(dt_portada$web, "c('bicivalencia.lasprovincias.es', 'blogs.lasprovincias.es', 'campusparty.lasprovincias.es', 
                        'especiales.lasprovincias.es', 'firmas.lasprovincias.es', 'servicios.lasprovincias.es', 'valenciacf.lasprovincias.es', 
                        'www1.lasprovincias.es')='lasprovincias.es'")

#as.com
dt_portada$web <-recode(dt_portada$web, "c('futbol.as.com', 'masdeporte.as.com', 'motor.as.com', 'www-org.as.com')='as.com'")


#meristation.com
dt_portada$web <-recode(dt_portada$web, "c('zonaforo.meristation.com', 'meristation.as.com', 'meristation.com.mx')='meristation.com'")

#valenciaplaza.com
dt_portada$web <-recode(dt_portada$web, "c('epoca1.valenciaplaza.com')='valenciaplaza.com'")

#formulatv.com
dt_portada$web <-recode(dt_portada$web, "c('blogs.formulatv.com')='formulatv.com'")

#theguardian.com
dt_portada$web <-recode(dt_portada$web, "c('guardian.co.uk', 'observer.guardian.co.uk', 'm.guardian.co.uk', 'technology.guardian.co.uk', 
                        'arts.guardian.co.uk', 'film.guardian.co.uk', 'lifeandhealth.guardian.co.uk', 'politics.guardian.co.uk', 
                        'travel.guardian.co.uk')='theguardian.com'")

#diariodemallorca.es
dt_portada$web <-recode(dt_portada$web, "c('ocio.diariodemallorca.es', 'blog.diariodemallorca.es', 'comunidades.diariodemallorca.es', 
                        'videos.diariodemallorca.es')='diariodemallorca.es'")

#elcorreodigital.com
dt_portada$web <-recode(dt_portada$web, "c('blogs.elcorreodigital.com', 'elcorreodigital.finanzas.com', 'elcorreodigital.hoytecnologia.com',
                        'servicios.elcorreodigital.com', 'elcorreodigital.hoyinversion.com', 'eurocopa2008.elcorreodigital.com', 
                        'cibernauta.elcorreodigital.com', 'hoysport.elcorreodigital.com', 'salud.elcorreodigital.com')='elcorreodigital.com'")

#elcorreo.com
dt_portada$web <-recode(dt_portada$web, "c('blogs.elcorreo.com', 'ciencia.elcorreo.com', 'especiales.elcorreo.com', 'info.elcorreo.com', 
                        'm.elcorreo.com', 'actualidad.elcorreo.com', 'bilbaobasket.elcorreo.com', 'vamosacorrer.elcorreo.com')='elcorreo.com'")

#ideal.es
dt_portada$web <-recode(dt_portada$web, "c('blogs.ideal.es', 'deportebase.ideal.es', 'hoysport.ideal.es', 'salud.ideal.es', 
                        'ubeda.ideal.es')='ideal.es'")

#bandaancha.eu
dt_portada$web <-recode(dt_portada$web, "c('backstage.bandaancha.eu', 'bandaancha.st', 'rwx.bandaancha.st')='bandaancha.eu'")

#infolibre.es
dt_portada$web <-recode(dt_portada$web, "c('blog.infolibre.es', 'elblogdexnet.infolibre.es', 'porlovisto.infolibre.es')='infolibre.es'")

#laverdad.es
dt_portada$web <-recode(dt_portada$web, "c('blog.laverdad.es', 'blogs.laverdad.es', 'canales.laverdad.es', 'lospiesenlatierra.laverdad.es', 
                        'verano.laverdad.es', 'videos.laverdad.es')='laverdad.es'")

#eluniversal.com
dt_portada$web <-recode(dt_portada$web, "c('sociales.eluniversal.com', 'buscador.eluniversal.com', 'deportes.eluniversal.com', 
                        'economia.eluniversal.com', 'eluniversal.com', 'espectaculos.eluniversal.com', 'espectaculos.eluniversal.com', 
                        'internacional.eluniversal.com', 'm.eluniversal.com', 'politica.eluniversal.com', 
                        'sociales.eluniversal.com.com')='eluniversal.com'")

#naukas.com
dt_portada$web <-recode(dt_portada$web, "c('cienciaenelbar.naukas.com', 'danielmarin.naukas.com', 'edocet.naukas.com', 
                        'elprofedefisica.naukas.com', 'francis.naukas.com', 'fuga.naukas.com', 'irreductible.naukas.com', 'jmmulet.naukas.com', 
                        'listadelaverguenza.naukas.com', 'maikelnai.naukas.com', 'mati.naukas.com', 'pacobellido.naukas.com', 
                        'zoologik.naukas.com')='naukas.com'")

#telecinco.es
dt_portada$web <-recode(dt_portada$web, "c('12meses12causas.telecinco.es', 'aquihaytomate.telecinco.es', 'blogs.telecinco.es', 
                        'cine.telecinco.es', 'diariode.telecinco.es', 'dutifri.telecinco.es', 'f1.informativos.telecinco.es', 'gente5.telecinco.es', 
                        'granhermano.telecinco.es', 'informativos.telecinco.es', 'mitele.telecinco.es')='telecinco.es'")

#antena3.com
dt_portada$web <-recode(dt_portada$web, "c('antena3noticias.com', 'blogs.antena3.com', 'foros.antena3.com')='antena3.com'")

#clarin.com
dt_portada$web <-recode(dt_portada$web, "c('blogs.clarin.com', 'edant.clarin.com', 'ieco.clarin.com', 'jjoo.clarin.com', 
                        'old.clarin.com', 'ole.clarin.com', 'revistaenie.clarin.com', 'weblogs.clarin.com')='clarin.com'")

#aldea-irreductible.blogspot.com
dt_portada$web <-recode(dt_portada$web, "c('aldea-irreductible.blogspot.com.es')='aldea-irreductible.blogspot.com'")

#infobae.com
dt_portada$web <-recode(dt_portada$web, "c('america.infobae.com', 'blogs.infobae.com', 'infobae.com.ar', 'opinion.infobae.com', 
                        'saludable.infobae.com')='infobae.com'")

#theinquirer.es
dt_portada$web <-recode(dt_portada$web, "c('es.theinquirer.net', 'theinquirer.es', 'theinquirer.net', 'theinquirer.org', 
                        'uk.theinquirer.net')='theinquirer.es'")

#fogonazos.es
dt_portada$web <-recode(dt_portada$web, "c('fogonazos.blogspot.com')='fogonazos.es'")

#periodistadigital.com
dt_portada$web <-recode(dt_portada$web, "c('blogs.periodistadigital.com')='periodistadigital.com'")

#google.com
dt_portada$web <-recode(dt_portada$web, "c('afp.google.com', 'ap.google.com', 'base.google.com', 'books.google.com', 
                        'canadianpress.google.com', 'chrome.google.com', 'code.google.com', 'desktop.google.com', 
                        'developers.google.com', 'docs.google.com', 'drive.google.com', 'earth.google.com', 'finance.google.com', 
                        'google.com.mt', 'groups.google.com', 'images.google.com', 'labs.google.com', 'mail.google.com', 
                        'maps.google.com', 'music.google.com', 'news.google.com', 'news.google.com.co', 'pack.google.com', 
                        'pages.google.com', 'picasaweb.google.com', 'play.google.com', 'plus.google.com', 'productforums.google.com', 
                        'quickdraw.withgoogle.com', 'research.google.com', 'services.google.com', 'sites.google.com', 'sketchup.google.com', 
                        'spreadsheets.google.com', 'support.google.com', 'translate.google.com', 'video.google.com', 
                        'wave.google.com')='google.com'")

#eitb.com
dt_portada$web <-recode(dt_portada$web, "c('blog.eitb.com', 'blog.eitb24.com', 'blogseitb.com', 'eitb.com', 'eitb.eus', 'eitb.tv', 
                        'eitb24.com', 'mediablog.eitb24.com')='eitb.com'")

#imgur.com
dt_portada$web <-recode(dt_portada$web, "c('ayesee.imgur.com', 'halytech.imgur.com', 'i.imgur.com', 'imgurfun.net', 
                        'sinasterisco.imgur.com')='imgur.com'")

#diariodesevilla.es
dt_portada$web <-recode(dt_portada$web, "c('diariodesevilla.com')='diariodesevilla.es'")

#tercerainformacion.es
dt_portada$web <-recode(dt_portada$web, "c('blogs.tercerainformacion.es')='tercerainformacion.es'")

#cuatro.com
dt_portada$web <-recode(dt_portada$web, "c('blog.cuatro.com', 'blogs.cuatro.com', 'foros.cuatro.com', 'play.cuatro.com')='cuatro.com'")

#amazings.es
dt_portada$web <-recode(dt_portada$web, "c('amazings.com')='amazings.es'")

#barrapunto.com
dt_portada$web <-recode(dt_portada$web, "c('softlibre.barrapunto.com', 'preguntas.barrapunto.com', 'espana.barrapunto.com', 
                        'empleo.barrapunto.com', 'debian.barrapunto.com', 'ciencia.barrapunto.com', 'ciberderechos.barrapunto.com', 
                        'bp25.barrapunto.com', 'americas.barrapunto.com')='barrapunto.com'")

#wired.com
dt_portada$web <-recode(dt_portada$web, "c('blog.wired.com', 'howto.wired.com', 'news.wired.com', 'wired.co.uk', 'wired.reddit.com', 
                        'wireservice.wired.com')='wired.com'")

#consumer.es
dt_portada$web <-recode(dt_portada$web, "c('escuelas.consumer.es', 'museos.consumer.es', 'revista.consumer.es')='consumer.es'")

#wikipedia.org
dt_portada$web <-recode(dt_portada$web, "c('ca.wikipedia.org', 'en.wikipedia.org', 'es.wikipedia.org', 'eu.wikipedia.org', 
                        'fr.wikipedia.org', 'gl.wikipedia.org', 'it.wikipedia.org', 'mail.wikipedia.org', 
                        'static.wikipedia.org')='wikipedia.org'")

#independent.co.uk
dt_portada$web <-recode(dt_portada$web, "c('environment.independent.co.uk', 'i100.independent.co.uk', 
                        'news.independent.co.uk')='independent.co.uk'")

#mimesacojea.com
dt_portada$web <-recode(dt_portada$web, "c('mimesacojea.blogspot.com')='mimesacojea.com'")

#washingtonpost.com
dt_portada$web <-recode(dt_portada$web, "c('blog.washingtonpost.com', 'blogs.washingtonpost.com', 'knowmore.washingtonpost.com', 
                        'm.washingtonpost.com', 'voices.washingtonpost.com', 'wpcomics.washingtonpost.com')='washingtonpost.com'")

#finanzas.com
dt_portada$web <-recode(dt_portada$web, "c('blogs.finanzas.com', 'foro.finanzas.com', 'laverdad.finanzas.com', 
                        'xlsemanal.finanzas.com')='finanzas.com'")

#engadget.com
dt_portada$web <-recode(dt_portada$web, "c('engadgetmobile.com', 'es.engadget.com', 'spanish.engadget.com', 
                        'transportation.engadget.com')='engadget.com'")

#prnoticias.com
dt_portada$web <-recode(dt_portada$web, "c('prnoticias.es')='prnoticias.com'")

#astroseti.org
dt_portada$web <-recode(dt_portada$web, "c('astrobiologia.astroseti.org', 'ciencia.astroseti.org', 
                        'esa.astroseti.org')='astroseti.org'")

#vice.com
dt_portada$web <-recode(dt_portada$web, "c('broadly.vice.com', 'i-d.vice.com', 'motherboard.vice.com', 'news.vice.com', 
                        'thecreatorsproject.vice.com')='vice.com'")

#larepublica.com
dt_portada$web <-recode(dt_portada$web, "c('afindemes.republica.com', 'blogs.republica.com')='larepublica.com'")

#cnn.com
dt_portada$web <-recode(dt_portada$web, "c('apple20.blogs.fortune.cnn.com', 'archives.cnn.com', 'brainstormtech.blogs.fortune.cnn.com', 
                        'cnn.netscape.cnn.com', 'cnnespanol.cnn.com', 'cnnpressroom.blogs.cnn.com', 'edition.cnn.com', 'ireport.cnn.com', 
                        'larrykinglive.blogs.cnn.com', 'mexico.cnn.com', 'money.cnn.com', 'news.blogs.cnn.com', 'sportsillustrated.cnn.com', 
                        'us.cnn.com')='cnn.com'")

#boredpanda.com
dt_portada$web <-recode(dt_portada$web, "c('boredpanda.es', 'boredpanda.org')='boredpanda.com'")

#nasa.com
dt_portada$web <-recode(dt_portada$web, "c('antwrp.gsfc.nasa.gov', 'apod.nasa.gov', 'blogs.nasa.gov', 'ciencia.nasa.gov', 'climate.nasa.gov', 
                        'data.giss.nasa.gov', 'earthasart.gsfc.nasa.gov', 'earthobservatory.nasa.gov', 'eobglossary.gsfc.nasa.gov', 
                        'eol.jsc.nasa.gov', 'eyes.jpl.nasa.gov', 'imagine.gsfc.nasa.gov', 'ipac.jpl.nasa.gov', 'jpl.nasa.gov', 
                        'lars-lab.jpl.nasa.gov', 'm.earthobservatory.nasa.gov', 'map.gsfc.nasa.gov', 'mars.nasa.gov', 
                        'marsrovers.jpl.nasa.gov', 'microgravity.grc.nasa.gov', 'neo.jpl.nasa.gov', 'opensource.arc.nasa.gov', 
                        'photojournal.jpl.nasa.gov', 'rapidfire.sci.gsfc.nasa.gov', 'saturn.jpl.nasa.gov', 'science.nasa.gov', 
                        'software.nasa.gov', 'sohowww.nascom.nasa.gov', 'solarsystem.nasa.gov', 'space.jpl.nasa.gov', 'spaceflight.nasa.gov', 
                        'sunearth.gsfc.nasa.gov', 'svs.gsfc.nasa.gov', 'visibleearth.nasa.gov')='nasa.gov'")

#periodismohumano.com
dt_portada$web <-recode(dt_portada$web, "c('alianzas.periodismohumano.com', 'consumeymuere.periodismohumano.com', 
                        'guatemalacomunitaria.periodismohumano.com', 'losrostrosdelosrecortes.periodismohumano.com', 
                        'minotauro.periodismohumano.com', 'pandoras.periodismohumano.com', 'polvodeestrellas.periodismohumano.com', 
                        'tomalapalabra.periodismohumano.com', 'traslapolitica.periodismohumano.com', 
                        'trata.periodismohumano.com')='periodismohumano.com'")

#univision.com
dt_portada$web <-recode(dt_portada$web, "c('dinero.univision.com', 'entretenimiento.univision.com', 'feeds.univision.com', 
                        'nfl.univision.com', 'noticias.univision.com')='univision.com'")

```

Después de las transformaciones vemos que el origen más frecuente de las noticias de portada de menéame es elpais.com con 7.550 noticias. Este resultado no deja de ser llamativo porque desde el año 2014 existe un boicot a los medios pertenecientes a la Asociación de Medios de Información (AMI), antigua Asociación de Editores de Diarios Españoles (AEDE), lo que significa que se promueve activamente el descarte de las noticias provenientes de los medios pertenecientes a esta organización. El diario El País es uno de estos medios, además, en segundo lugar de la clasificación encontramos el diario El Mundo y en las primeras 20 posiciones podemos encontrar otros medios AEDE como La Vanguardia, ABC, La Voz de Galicia, etc. 

```{r meneame_2, include=FALSE}
#Gráfico de nº de portadas
webs <- as.data.frame(table(dt_portada$web))
webs <- webs[order(-webs$Freq),] 
table(webs$Freq)

#Estadisticos
summary(webs$Freq)

ggplot(data=webs[c(1:30),], aes(x=reorder(Var1, -Freq), y=Freq)) +
  geom_bar(stat="identity", fill="gray28") + theme_classic() +
  geom_text(aes(label=Freq), vjust=1.6, color="white", size=3.5)+
   theme(axis.text.x = element_text(angle = 40, hjust = 1, size=12))  + 
  scale_y_continuous(expand = c(0,0)) + labs(x = "Origen", y="Nº de noticias en portada", title="Origen de las noticias de portada")
```

Podemos ver los 30 orígenes más frecuentes de las noticias de portada de menéame en el siguiente gráfico:

```{r meneame_3, echo=FALSE, fig.width=14, fig.height=6}
ggplot(data=webs[c(1:25),], aes(x=reorder(Var1, -Freq), y=Freq)) +
  geom_bar(stat="identity", fill="gray28") + theme_classic() +
  geom_text(aes(label=Freq), vjust=1.6, color="white", size=3.5)+
   theme(axis.text.x = element_text(angle = 40, hjust = 1, size=12))  + 
  scale_y_continuous(expand = c(0,0)) + labs(x = "Origen", y="Nº de noticias en portada", title="Origen de las noticias de portada")
```

Para acabar este apartado veamos la proporción total de noticias en portada que tiene cada medio. Por motivos de memoria se han incluido en el apartado "otros"" los 89.341 medios que tienen entre 1 y 250 noticias en portada.


```{r meneame_4, echo=FALSE, warning=F}
dt_tree <- webs %>% group_by(Var1) %>% summarise(n=sum(Freq))
dt_tree$Var1 <- as.character(dt_tree$Var1)
dt_tree$Var1[dt_tree$n < 250] <- "otros"
dt_tree <- dt_tree %>% group_by(Var1) %>% summarise(n=sum(n))


plot_ly(dt_tree, labels = ~(factor(Var1)), values = ~n, type = "pie", textinfo = 'none') %>% 
  layout(title = "Medios con mas noticias en portada", showlegend = T, font=list(size = 13))
```

## ¿Qué usuarios son los más activos?

```{r meneame_5, include=FALSE}
df_users <- as.data.frame(sort(table(dt_portada$usuario), decreasing = T))
table(df_users$Freq)
```

Otro apartado interesante es el relativo a los usuarios. Tenemos un total de 22.149 usuarios distintos que han subido 177.509 noticias diferentes. La media de envíos por usuario es de 8 noticias y la mediana es igual a 2. 
  
El usuario que más noticias ha subido a portada es mezvan, con 2.561 un 1,44% del total; seguido por Tanatos con 2.046 y Ratoncolorao con 1.297. En los 25 primeros puestos tenemos además a tres usuarios cuyas cuentas fueron eliminadas. Son aquellos cuyo apodo es un número franqueado por dos guiones. Un total de 10.144 usuarios tiene una única portada. La cifra va descendiendo paulatinamente: 3.470 con 2, 1780 con 3, 1136 con 4, etc.


```{r meneame_6, echo=FALSE, fig.width=14, fig.height=6}
ggplot(data=df_users[c(1:25),], aes(x=reorder(Var1, -Freq), y=Freq)) +
  geom_bar(stat="identity", fill="gray28") + theme_classic() +
  geom_text(aes(label=Freq), vjust=1.6, color="white", size=3.5)+
  theme(axis.text.x = element_text(angle = 40, hjust = 1, size=12))  + 
  scale_y_continuous(expand = c(0,0)) + labs(x = "Usuario", y="Nº de noticias en portada", title="Usuarios con mas noticias en portada")
```

Veamos por último la proporción de noticias que los usuarios han subido del total. En el apartado "otros" se encuentran los 149.881 usuarios que han subido 300 noticias o menos. 

```{r meneame_7, echo=FALSE, warning=F}
dt_tree <- df_users %>% group_by(Var1) %>% summarise(n=sum(Freq))
dt_tree$Var1 <- as.character(dt_tree$Var1)
dt_tree$Var1[dt_tree$n < 300] <- "otros"
dt_tree <- dt_tree %>% group_by(Var1) %>% summarise(n=sum(n))


plot_ly(dt_tree, labels = ~(factor(Var1)), values = ~n, type = "pie", rotation=320, textinfo = 'none') %>% 
  layout(title = "Usuarios con mas noticias en portada", showlegend = T, font=list(size = 13))  
```

## ¿Qué subs llegan a portada?

Los subs son secciones temáticas dentro de menéame que permiten personalizar los temas. Éstos sustituyeron a las categorías, que eran los subgrupos que agrupaban a las noticias. Entraron en funcionamiento el 27 de marzo de 2014. 

No hay datos de categorías anteriores a esta fecha, pero a partir de ésta podemos comprobar qué subs son los que llegan a portada. 

La agrupación de resultados muestra que desde que se crearon, un total de 113 subs diferentes han tenido noticias en la portada de menéame.

```{r meneame_8, include=FALSE, warning=F}
#Estandarizamos los datos anteriores a la implementacion de los subs el 27 de marzo de 2014
dt_portada$sub[dt_portada$fecha_publicacion < "2014-03-26"] <-"mnm"

#Eliminamos las noticias no clasificadas
dt_sub <- dt_portada[!dt_portada$sub == "mnm", ] 

#Dejamos las noticias por sub y año
dt_sub <- dt_sub[,c(8, 16)] %>%
  group_by(month=floor_date(fecha_publicacion, "year"), sub) %>% select(-c(fecha_publicacion)) %>% 
  mutate(unique_types = n_distinct(sub))
dt_sub <- as.data.frame(table(dt_sub$sub, dt_sub$month))
dt_sub <- dt_sub[!dt_sub$Freq == 0,]

#Nº de subs con noticias en portada
length(unique(dt_sub$Var1))
```

En el gráfico aparecen por separado todos aquellos subs que han conseguido tener al menos 70 noticias en portada, los que han conseguido menos se agrupan en la categoría otros. 

```{r meneame_9, echo=FALSE, warning=F}
#Total de noticias en portada de cada sub
dt_pie <- dt_sub %>% group_by(Var1) %>% summarise(n=sum(Freq))
dt_pie$Var1 <- as.character(dt_pie$Var1)
dt_pie$Var1[dt_pie$n < 70] <- "otros"
dt_pie <- dt_pie %>% group_by(Var1) %>% summarise(n=sum(n))

plot_ly(dt_pie, labels = ~(factor(Var1)), values = ~n, type = "pie") %>% 
  layout(title = "Subs a los que pertenecen las noticias de portada", showlegend = T, font=list(size = 13))
  
```
  
Los subs que más presencia tienen en portada son por este orden: actualidad con 23.958 noticias, el 56,8% del total; cultura con 9.548 noticias, el 22,6% y tecnología con 1.421 noticias, el 10,5%. 

## ¿Cómo han ido evolucionando las portadas con el tiempo?
La primera portada de menéame tuvo lugar el 7 de septiembre de 2005. El autor del primer meneo fue Gallir y era una publicación de prueba. Esas tres semanas de diciembre 29 noticias llegaron a portada, y a partir de ahí las noticias en portada sufrieron un avance exponencial. El mes con más noticias fue junio de 2008 (724 portadas). Éste es el mes en el que España ganó la Eurocopa, el paro empezaba a dispararse y se empezaba a hablar (o a negar) la existencia de la crisis. Si nos fijamos en los datos anuales, el máximo ocurrió en el año 2009, con 7.212 noticias en portada. 

```{r meneame_10, echo=FALSE, warning=F}
MyMerge <- function(x, y){
  #Funcion que fusiona df
  df <- merge(x, y,  by="date", all=T)
  return(df)
}

gen_df_ts_m <- function(x, anual=FALSE){
  #Funcion que genera el DF con el envío mensual de noticias. Requiere función MyMerge. 
  #Requiere x, que es el nº de medios que queremos en orden decreciente. Si anual = TRUE, se hace la serie anual en vez de mensual
  webl <- names(sort(table(dt_portada$web), decreasing = T))[1:x]
  
  l_obj <- c()
  l_str <- c()
  for(i in webl){
    ar <- strsplit(i, "[.]")
    ar <- gsub("-", "_", ar[[1]][1])
    if(anual==T){
      eval(parse(text=paste("ts_a_", ar, " <- dt_portada %>% sub_set('web', '", i, "') %>% ts_anual ", sep="")))
      ini <- "ts_a_"
    }else{
    eval(parse(text=paste("ts_m_", ar, " <- dt_portada %>% sub_set('web', '", i, "') %>% ts_mensual ", sep="")))
      ini <- "ts_m_"
    }
    
    #Construccion lista objetos
    if(length(l_obj) == 0){
      l_obj <- paste(ini, ar, sep="")
    }else {
      l_obj <- paste(l_obj, paste(ini, ar, sep=""), sep=",")
    }
    
    #Construcción lista strings
    if(length(l_str) == 0){
      l_str <- paste(paste("'", ini, sep=""), ar, "'",sep="")
    }else {
      l_str <- paste(l_str, paste(paste("'", ini, sep=""), ar, "'",sep=""), sep=",")
    }
  }
  l_obj <- paste("list(", l_obj, ")", sep="")
  l_str <- paste("c(", l_str, ")", sep="")
  
  ts_m_df20 <- eval(parse(text=l_obj))
  media_20 <- eval(parse(text=l_str))
  
  df_ts_m_20 <- Reduce(MyMerge, ts_m_df20)
  colnames(df_ts_m_20) <- c("date", media_20)
  df_ts_m_20[is.na(df_ts_m_20)] <- 0
  if(anual==T){
    df_ts_m_20$date  <- as.Date(paste(df_ts_m_20$date , '01-01', sep='-'), '%Y-%m-%d')
  }else{
    df_ts_m_20$date  <- as.Date(paste(df_ts_m_20$date , '01', sep='-'), '%Y-%m-%d')
  }
  
  df_ts_m_20 <- df_ts_m_20[!df_ts_m_20$date == "2017-12-01",]
  return(df_ts_m_20)
}

gen_ts_m_plot <- function(dataframe_ts){
  webl <- names(sort(table(dt_portada$web), decreasing = T))[1:length(dataframe_ts)]
  
  AEDE <- c('ts_m_elpais', 'ts_m_elmundo','ts_m_eleconomista', 'ts_m_lavanguardia', 'ts_m_abc', 'ts_m_elperiodico', 'ts_m_marca',
            'ts_m_lavozdegalicia', 'ts_m_levante_emv',  'ts_m_expansion', 'ts_m_elcorreo', 'ts_m_cincodias', 'ts_m_larazon', 
            'ts_a_elpais', 'ts_a_elmundo','ts_a_eleconomista', 'ts_a_lavanguardia', 'ts_a_abc', 'ts_a_elperiodico', 'ts_a_marca',
            'ts_a_lavozdegalicia', 'ts_a_levante_emv',  'ts_a_expansion', 'ts_a_elcorreo', 'ts_a_cincodias', 'ts_a_larazon')
  
  for(i in (1:(length(dataframe_ts)-1))){
    if(colnames(dataframe_ts)[i+1] %in% AEDE){
      ar <- paste("add_trace(dt_portada, y = ~", colnames(dataframe_ts)[i+1], ", legendgroup = 'AEDE', name = '", webl[i], "')", sep="")
    }else{
      ar <- paste("add_trace(dt_portada, y = ~", colnames(dataframe_ts)[i+1], ", name = '", webl[i], "')", sep="")
    }
    
    if(exists("l_plots") == F){
      l_plots <- ar
    }else {
      l_plots <- paste(l_plots, ar, sep=" %>% ")
    }
  }
  
  return(eval(parse(text=paste("plot_ly(dataframe_ts, x = ~date, y = rowSums(dataframe_ts[2:length(dataframe_ts)]), mode = 'lines', type = 'scatter', name = 'Total de envíos') %>% 
                               layout(title = 'Evolucion temporal', showlegend = T, xaxis=list(title='Fecha'), yaxis=list(title='Nº de portadas'))", 
                        l_plots, sep=" %>%"))))
}

#Generamos el gráfico mensual y anual de envíos
dt_ts_m <- gen_df_ts_m(30)
gen_ts_m_plot(dt_ts_m)
```

Hay otros dos picos en los que se superaron las 700 noticias en portada: mayo de 2011 (15-M) y enero de 2012 (Justo después de la toma de posesión de Rajoy, cuando se escondían las tijeras hasta que pasaran las elecciones andaluzas). A partir de ahí el número de noticias de portada empezó a caer lentamente. Se pasó de las 7.147 noticias en portada del año 2011 a las 4.526 del año 2016; aunque la tendencia descendiente se rompe en 2017 ya que este año las portadas aumentaron. Llaman la atención varios picos en los gráficos mensuales: octubre de 2014 (555 noticias, crisis del ébola en España) y mayo de 2015 (552 noticias, elecciones locales). A partir de ahí las noticias en portada fueron bajando hasta llegar al mínimo de noviembre de 2016 (261 noticias). Y es que la crisis de gobierno Española de 2016  tuvo un efecto directo sobre las portadas. Los últimos dos picos ocurrieron en mayo de 2017 (elecciones a secretario general del PSOE, repunte de las noticias de corrupción, crisis del Fiscal General Moix, elecciones francesas, ...) y en octubre de 2017 (el procés).

Por último, podemos ver como salvo excepciones muy puntuales, se ha respetado el boicot a los medios AEDE: se pasó de 98 portadas de medios AEDE en febrero de 2014 a 0 en el mes de marzo. Es interesante ver como el papel que antes tenían en la web elpais.com y elmundo.es; ahora lo tienen eldiario.es y elconfidencial.com respectivamente.


```{r meneame_11, echo=FALSE, warning=F}
dt_ts_a <- gen_df_ts_m(30, T)
gen_ts_m_plot(dt_ts_a)
```

## ¿Qué tiempo pasa desde que se envía una noticia hasta que sube a portada?
De media pasan unas 7,12 horas desde que una noticia es enviada hasta que es publicada en la portada. La noticia que más rápido llegó a portada fue "España campeona de Europa de Baloncesto tras vencer a Serbia 85-63" el 20 de septiembre del año 2009, tardó sólo 91 segundos. Por el contrario, el envío que más tiempo tardó en llegar a portada fue "Click Here You Idiot". Fue enviada el 5 de enero de 2006 a las 18h y no subió a portada hasta el día 15 de enero a las 4h, nueve días y medio después. Este caso es muy excepcional y es bastante raro encontrar envíos con más de 3 días que lleguen a portada. 

```{r meneame_12, echo=FALSE, warning=F}
dt_subida <- dt_portada[, c(4, 5, 16)]
dt_subida$t_subida_min <- as.numeric(difftime(dt_portada$fecha_publicacion, dt_portada$fecha_envio), units="mins")
dt_subida$t_subida_horas <- as.numeric(difftime(dt_portada$fecha_publicacion, dt_portada$fecha_envio), units="hours")
dt_subida$t_subida_dia <- as.numeric(difftime(dt_portada$fecha_publicacion, dt_portada$fecha_envio), units="days")

plot_ly(type = "box", width = 450, height = 500) %>% 
  layout(autosize = F, title = "Horas hasta llegar a portada", showlegend = F, font=list(size = 13), xaxis=list(title=""), yaxis=list(title="Nº de Horas")) %>%
  add_boxplot(data=dt_subida, y = ~t_subida_horas, name = "Todas") 
```

Por otra parte, el sub de la noticia determina el tiempo que tarda en subir a portada. Las noticias de actualidad son las que más rápido suben, mientras que las noticias de ciencia son las que más tiempo tardan en subir a portada. 

```{r meneame_13, echo=FALSE, warning=F}
#Por subs
#Eliminamos las noticias no clasificadas
dt_subida_subs <- dt_subida[!dt_subida$sub == "mnm", ] 
dt_subida_subs[!dt_subida_subs$sub %in% c("actualidad", "astronomia", "ciencia", "cultura", "ocio", "tecnología"), "sub"] <- "otros" 

plot_ly(dt_subida_subs, y = ~t_subida_horas, color = ~sub, type = "box", xaxis = list(tickangle = 45)) %>% 
  layout(title = "Horas hasta llegar a portada | Por sub", showlegend = T, font=list(size = 13), xaxis=list(title=""), yaxis=list(title="Nº de Horas"))
```

## Votos, comentarios y karma
En general, vemos que:

La media de meneos han sido 585. Con un máximo de 12.389 y un mínimo de 10. 

La media de votos positivos han sido 239. Con un máximo de 3.315 y un mínimo de 6. 

La media de votos anónimos han sido 346. Con un máximo de 9.597 y un mínimo de 0. 

La media de votos negativos han sido 2. Con un máximo de 246 y un mínimo de 0. 

La media de karma han sido 2. Con un máximo de 246 y un mínimo de 0. 

La media de clics en las noticias es de 6.569. Con un máximo de 113.528 y un mínimo de 29 (Sólo hay datos a partir de octubre de 2010).

La media de comentarios por noticia es de 48. El máximo es 2.718 y existen 680 noticias sin comentarios.

```{r meneame_14, echo=FALSE, warning=F}
dt_karma <- dt_portada[, c(4, 5, (9:16))]
dt_karma$clicks <- as.integer(dt_karma$clicks)
dt_karma$comentarios <- as.integer(dt_karma$comentarios)
#summary(dt_karma[, c(3:9)])

plot_ly(type = "box") %>% 
  layout(autosize = F, title = "Nº de votos | Total de karma", showlegend = F, font=list(size = 13), xaxis=list(title=""), yaxis=list(title="Total")) %>%
  add_boxplot(data=dt_karma, y = ~meneos, name = "Meneos") %>%
  add_boxplot(data=dt_karma, y = ~votos_positivos, name = "V. Positivos") %>%
  add_boxplot(data=dt_karma, y = ~votos_anonimos, name = "V. Anónimos") %>%
  add_boxplot(data=dt_karma, y = ~votos_negativos, name = "V. Negativos") %>%
  add_boxplot(data=dt_karma, y = ~karma, name = "Karma") %>%
  add_boxplot(data=dt_karma, y = ~comentarios, name = "Comentarios")
```

Si comparamos los datos de karma con otras categorías, como los 10 usuarios más activos o los subs, vemos por ejemplo que las noticias de portada enviadas por el usuario mezvan o camachosoft, y especialmente las de aberron suelen obtener más karma que la de otros usuarios. 

```{r meneame_15, echo=FALSE, warning=F}
dt_karma_users <- dt_karma[dt_karma$usuario %in% c("mezvan", "Tanatos", "Ratoncolorao", "jm22381", "camachosoft", "juvenal", "Ripio", "--136875--", "disconubes", "aberron"), ]
  #Karma
  plot_ly(dt_karma_users, y = ~karma, color = ~usuario, type = "box", xaxis = list(tickangle = 45)) %>% 
    layout(title = "Karma | Por usuario", showlegend = T, font=list(size = 13), xaxis=list(title=""), yaxis=list(title="Total de karma"), margin = list(b = 70))  
```

También son interesantes los datos de los meneos por categoría. Las noticias de actualidad obtienen muchísimos más meneos que las de cualquier otra categoría. 

```{r meneame_16, echo=FALSE, warning=F}
#Por subs
#Eliminamos las noticias no clasificadas
dt_karma_subs <- dt_karma[!dt_karma$sub == "mnm", ] 
dt_karma_subs[!dt_karma_subs$sub %in% c("actualidad", "astronomia", "ciencia", "cultura", "ocio", "tecnología"), "sub"] <- "otros" 

  #Meneos
  plot_ly(dt_karma_subs, y = ~meneos, color = ~sub, type = "box", xaxis = list(tickangle = 45)) %>% 
    layout(title = "Meneos | Por sub", showlegend = T, font=list(size = 13), xaxis=list(title=""), yaxis=list(title="Nº de meneos"), margin = list(b = 50))
```    
  
Por último, veamos la evolución temporal de los meneos, votos positivos, votos negativos, karma y clics a lo largo del tiempo.

```{r meneame_17, echo=FALSE, warning=F}
#Evolucion temporal votos y karma
gen_ts_month_values<- function(x) {
  dt_portada$meneos <- as.integer(dt_portada$meneos)
  dt_portada$votos_positivos <- as.integer(dt_portada$votos_positivos)
  dt_portada$votos_negativos <- as.integer(dt_portada$votos_negativos)
  dt_portada$karma <- as.integer(dt_portada$karma)
  dt_portada$clicks <- as.integer(dt_portada$clicks)
  dt_portada$votos_anonimos <- as.integer(dt_portada$votos_anonimos)
  sal <- dt_portada %>%
    mutate(date = format(fecha_publicacion, "%Y-%m")) %>%
    group_by(date) %>% summarise(tot_men=sum(meneos), tot_pos=sum(votos_positivos), tot_anom=sum(votos_anonimos), tot_neg=sum(votos_negativos), tot_kar=sum(karma), tot_clicks=sum(clicks))
  sal <- sal[!sal$date == "2017-12",]
  
  plot_ly(sal, x = ~date, y = ~tot_men, mode = 'lines', type = 'scatter', name = 'Meneos') %>% 
    layout(title = 'Evolucion temporal', showlegend = T,  yaxis=list(title='Valor total'), xaxis=list(title='')) %>%
    add_trace(sal, y = ~tot_pos, name = 'Votos Positivos') %>% 
    add_trace(sal, y = ~tot_anom, name = 'Votos Anonimos') %>% 
    add_trace(sal, y = ~tot_neg, name = 'Votos Negativos') %>% 
    add_trace(sal, y = ~tot_kar, name = 'Karma') %>% 
    add_trace(sal, y = ~tot_clicks, name = 'Clicks')
}


gen_ts_month_values()
```

Puede verse claramente la caída a la mitad de todos los valores (salvo los votos negativos), y lo que parece una estabilización en los últimos meses. 

## ¿De qué tratan las noticias de portada?
Y bueno, por último he hecho algunas nubes de palabras con los titulares de las noticias de portada. He tenido algunos problemas con la codificación del texto y aparecen sin caracteres especiales (acentos, eñes, etc.) y con algunos pequeños errores. Pero aún así, son interesantes. 


```{r meneame_18, echo=FALSE, warning=F}
rmstrange <- function(x) stringr::str_replace_all(x,"[^[:graph:]]", " ")
rmacentos <- function(x)  chartr("áàâäéëèêíïìîóöòôúüùûñ", "aaaaeeeeiiiioooouuuun", x)

gen_cloud <- function(dataf,x){
  #Titulares - Total
  corpus_tit <- Corpus(VectorSource(dataf), readerControl = list(reader = readPlain, language = "es"))
  corpus_tit <- tm_map(corpus_tit, content_transformer(removePunctuation))
  corpus_tit <- tm_map(corpus_tit, content_transformer(tolower))
  corpus_tit <- tm_map(corpus_tit, content_transformer(rmstrange))
  corpus_tit <- tm_map(corpus_tit, content_transformer(rmacentos))
  corpus_tit <- tm_map(corpus_tit, removeWords, c(stopwords("spanish"), "eng", "cómo", "ser", "ing", "pide", "tras", "así", "dice", "solo", "cada", "gran", "asi", "â€œ", "casi",  "the", "100", "mas"))
  corpus_tit <- tm_map(corpus_tit, content_transformer(stripWhitespace))
  corpus_tit <- tm_map(corpus_tit, content_transformer(trimws))
  
  corpus_tit <- TermDocumentMatrix(corpus_tit)
  
  corpus_tit <- removeSparseTerms(corpus_tit, .997)
  findFreqTerms(corpus_tit, lowfreq=1)                             
  
  corpus_tit <- weightTfIdf(corpus_tit,normalize=FALSE)
  corpus_tit <- as.matrix(corpus_tit)
  dim(corpus_tit)
  summary(rowSums(corpus_tit))
  
  corpus_tit <- sort(rowSums(corpus_tit), decreasing=TRUE)
  if(dataf==dt_portada$noticia){
  corpus_tit <- corpus_tit[-c(28)]
  names(corpus_tit) <- c("años", "España", "euros", "millones", "dos", "gobierno", "Madrid", "mundo", "policía","Rajoy", "google", 
                         "internet", "nuevo", "EE.UU", "hace", "historia", "ley", "tres","humor", "españoles", "nueva", "puede", "hombre", 
                         "español", "día", "primera", "año","mujer", "guerra", "personas", "vídeo", "PSOE", "país", "vida", "juez", "caso",
                         "vez", "sgae", "hacer", "europa", "casa", "primer", "crisis", "española", "dinero","menos", "después", "denuncia", 
                         "quiere", "muere", "niños", "agua", "cuatro", "muerte","segun", "linux", "fotos", "Barcelona", "pagar", "sistema", 
                         "mundial", "mayor", "ahora","Valencia", "joven", "Aguirre", "coche", "presidente", "web", "trabajo", "cárcel", 
                         "libre","horas", "mejor", "civil", "china", "ayuntamiento", "podemos", "real", "detenido", "luz","cinco", "público", 
                         "pública", "Zapatero", "diez", "hoy", "días", "ETA", "podría","estan", "imágenes", "alcalde", "windows", "partido", 
                         "microsoft", "congreso", "iglesia", "meses","tierra", "empresa", "descubren", "mujeres", "jóvenes", "Francia", 
                         "Alemania", "deja", "niño","científicos", "trabajadores", "red", "banco", "cat", "Rey", "software", "foto", 
                         "gana","guardia", "será", "anuncia", "seguridad", "tener", "nunca", "datos", "energía", "grupo","corrupción",
                         "canon", "nacional", "paro", "piden", "fin", "ciudad", "veces", "precio","familia", "hijo", "gratis", "también", 
                         "huelga", "grandes", "Bárcenas", "seis", "madre","dólares", "gente", "niña", "campana", "bajo", "unidos", "empresas",
                         "cáncer", "ver","avión", "viñeta", "sol", "carta", "elecciones", "Japón", "sanidad", "cambio", "tiempo","parte", 
                         "padre", "Israel", "toda", "inglés", "TVE", "calle", "medio", "metro","mes", "usuarios", "prisión", "solar", "uso", 
                         "amenaza", "vuelve", "ciencia", "pueblo","sueldo", "telefónica", "prensa", "muertos", "ministro", "poder", "mientras")
  }

  wordcloud(words=names(corpus_tit), freq=corpus_tit, random.order = FALSE, colors = RColorBrewer::brewer.pal(8, "Set2"), max.words=700)

}
```

## Todas las noticias
```{r meneame_19, echo=FALSE, warning=F}
#Todas las noticias
gen_cloud(dt_portada$noticia, "total")
```

### Año 2006 (primer año completo de vida de menéame)
#```{r meneame_20, echo=FALSE, warning=F}
##Por año
#
#df <- dt_portada[(dt_portada$fecha_publicacion > paste(as.character(2006),"-01-01", sep="") & dt_portada$fecha_publicacion < paste(as.character(2006+1),"-01-01", sep="")), 2] 
#gen_cloud(df, as.character(2006))
#
#```
#
### Año 2017
#```{r meneame_21, echo=FALSE, warning=F}
##Por año
#
#df <- dt_portada[(dt_portada$fecha_publicacion > paste(as.character(2017),"-01-01", sep="") & dt_portada$fecha_publicacion < paste(as.character(2017+1),"-01-01", sep="")), 2] 
#gen_cloud(df, as.character(2017))
#
#```
## Año 2022
```{r meneame_21, echo=FALSE, warning=F}
#Por año

df <- dt_portada[(dt_portada$fecha_publicacion > paste(as.character(2022),"-01-01", sep="") & dt_portada$fecha_publicacion < paste(as.character(2022+1),"-01-01", sep="")), 2] 
gen_cloud(df, as.character(2022))
#
#
##200 noticias con mas clicks
```{r meneame_22, echo=FALSE, warning=F}
df <- dt_portada[complete.cases(dt_portada[,10]), ]
df$clicks <- as.integer(df$clicks)
df <- df[order(df$clicks, decreasing = T),][c(1:200), 2]
gen_cloud(df, "200_mas_clicks")
```

##200 noticias con mas meneos
```{r meneame_23, echo=FALSE, warning=F}
df <- dt_portada[order(dt_portada$meneos, decreasing = T),][c(1:200), 2]
gen_cloud(df, "200_mas_meneos")
```

##200 noticias con mas votos positivos
```{r meneame_24, echo=FALSE, warning=F}
df <- dt_portada[order(dt_portada$votos_positivos, decreasing = T),][c(1:200), 2]
gen_cloud(df, "200_mas_positivos")
```

##200 noticias con mas votos anónimos
```{r meneame_25, echo=FALSE, warning=F}
df <- dt_portada[order(dt_portada$votos_anonimos, decreasing = T),][c(1:200), 2]
gen_cloud(df, "200_mas_anonimos")
```

##200 noticias con mas votos negativos
```{r meneame_26, echo=FALSE, warning=F}
df <- dt_portada[order(dt_portada$votos_negativos, decreasing = T),][c(1:200), 2]
gen_cloud(df, "200_mas_negativos")
```

##200 noticias con mas comentarios
```{r meneame_27, echo=FALSE, warning=F}
df <- dt_portada[order(dt_portada$comentarios, decreasing = T),][c(1:200), 2]
gen_cloud(df, "200_mas_comentarios")
```

##200 noticias con mas karma
```{r meneame_28, echo=FALSE, warning=F}
df <- dt_portada[order(dt_portada$karma, decreasing = T),][c(1:200), 2]
gen_cloud(df, "200_mas_karma")
```

Espero que os haya gustado :). 
